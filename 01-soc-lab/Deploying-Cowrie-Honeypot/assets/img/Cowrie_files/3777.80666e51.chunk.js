"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[3777],{73777:(e,n,i)=>{i.d(n,{h:()=>D});var a=i(64467),l=i(5544),t=i(55364),d=i.n(t),r=i(95420),u=i(96540),s=i(95964),o={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"NewsletterV3ViewerEdge"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"newsletterSlug"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"collectionSlug"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"username"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"newsletterV3"},arguments:[{kind:"Argument",name:{kind:"Name",value:"newsletterSlug"},value:{kind:"Variable",name:{kind:"Name",value:"newsletterSlug"}}},{kind:"Argument",name:{kind:"Name",value:"collectionSlug"},value:{kind:"Variable",name:{kind:"Name",value:"collectionSlug"}}},{kind:"Argument",name:{kind:"Name",value:"username"},value:{kind:"Variable",name:{kind:"Name",value:"username"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NewsletterV3"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"viewerEdge"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NewsletterV3ViewerEdge_newsletterV3ViewerEdge"}}]}}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"NewsletterV3ViewerEdge_newsletterV3ViewerEdge"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NewsletterV3ViewerEdge"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isSubscribed"}}]}}]},m=i(27721),k=i(21335),c=i(34317),v=i(49287),N=i(91830),b={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"useNewsletterV3Subscription_user"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"User"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"username"}},{kind:"Field",name:{kind:"Name",value:"newsletterV3"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"useNewsletterV3Subscription_newsletterV3"}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"useNewsletterV3Subscription_newsletterV3"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NewsletterV3"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"slug"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"collection"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"slug"}}]}},{kind:"Field",name:{kind:"Name",value:"user"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"username"}},{kind:"Field",name:{kind:"Name",value:"newsletterV3"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]}}]},S={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"SubscribeNewsletterV3Mutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"newsletterV3Id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shouldRecordConsent"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"subscribeNewsletterV3"},arguments:[{kind:"Argument",name:{kind:"Name",value:"newsletterV3Id"},value:{kind:"Variable",name:{kind:"Name",value:"newsletterV3Id"}}},{kind:"Argument",name:{kind:"Name",value:"shouldRecordConsent"},value:{kind:"Variable",name:{kind:"Name",value:"shouldRecordConsent"}}}]}]}}]},w={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UnsubscribeNewsletterV3Mutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"newsletterV3Id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"unsubscribeNewsletterV3"},arguments:[{kind:"Argument",name:{kind:"Name",value:"newsletterV3Id"},value:{kind:"Variable",name:{kind:"Name",value:"newsletterV3Id"}}}]}]}}]},p={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"FetchOrLazilyCreateNewsletterV3AndMaybeSubscribeMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fetchOrLazilyCreateNewsletterV3AndMaybeSubscribe"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"FragmentSpread",name:{kind:"Name",value:"useNewsletterV3Subscription_newsletterV3"}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"useNewsletterV3Subscription_newsletterV3"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NewsletterV3"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"slug"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"collection"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"slug"}}]}},{kind:"Field",name:{kind:"Name",value:"user"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"username"}},{kind:"Field",name:{kind:"Name",value:"newsletterV3"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]}}]},V=i(21800),g=i(80452),f=i(31261);function y(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,a)}return i}function F(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?y(Object(i),!0).forEach((function(n){(0,a.A)(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):y(Object(i)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}var D=function(e){var n=e.newsletterV3,i=e.creator,a=e.newsletterName,t=e.hideLinkInConfirmationToast,y=void 0!==t&&t,D=n||{},I=D.id,O=D.type,C=D.slug,E=D.collection,A=(null==n?void 0:n.user)||i,_=null!=a?a:null==n?void 0:n.name,h=(0,f.t)().viewerId,T=(0,k.cd)(null==A?void 0:A.id),L=T.viewerEdge,j=T.loading,P=(0,g.h)(),R=u.useState(!1),M=(0,l.A)(R,2),U=M[0],B=M[1],z=function(e){var n,i=e.newsletterSlug,a=void 0===i?"":i,l=e.collectionSlug,t=void 0===l?null:l,d=e.username,r=void 0===d?null:d,u=!!(0,m.R)().value,k=(0,s.IT)(o,{variables:{newsletterSlug:a,collectionSlug:t,username:r},ssr:!1,skip:!t&&!r||!a||!u}),c=k.loading,v=k.error,N=k.data;return c?{loading:c}:v?{error:v}:{viewerEdge:null==N||null===(n=N.newsletterV3)||void 0===n?void 0:n.viewerEdge}}({newsletterSlug:C,collectionSlug:null==E?void 0:E.slug,username:null==A?void 0:A.username}),q=z.viewerEdge,G=z.loading,H=u.useState(!1),K=(0,l.A)(H,2),Q=K[0],x=K[1];u.useEffect((function(){x(!(null==q||!q.isSubscribed))}),[null==q?void 0:q.isSubscribed]);var W=(0,c.$L)(),X=(0,v.jI)(),Y=(0,N.zF)();U&&W.event("newsletterV3.subscribe.error",{newsletterV3Id:I});var $=function(e,n,i){if(i){var a={id:"User:".concat(null==A?void 0:A.id),fragment:b,fragmentName:"useNewsletterV3Subscription_user"},l=e.readFragment(a);l&&e.writeFragment(F(F({},a),{},{data:F(F({},l),{},{newsletterV3:i})}))}if(q){var t=e.readQuery({query:o,variables:{newsletterSlug:C||"",collectionSlug:(null==E?void 0:E.slug)||null,username:(null==A?void 0:A.username)||null}}),r=d()({},t,{newsletterV3:{viewerEdge:{isSubscribed:n}}});e.writeQuery({query:o,variables:{newsletterSlug:C||"",collectionSlug:(null==E?void 0:E.slug)||null,username:(null==A?void 0:A.username)||null},data:r})}if(n&&null!=A&&A.id&&(null==L||!L.isFollowing)){var u=A.id;(0,V.M)({cache:e,userId:u,viewerId:h}),(0,k.YG)(e,u,{isFollowing:!0})}},J=(0,u.useCallback)((function(e){W.event("newsletterV3.subscribeClicked",{newsletterV3Id:e,source:X}),null!=L&&L.isFollowing||null==A||!A.id||P("user.followed",{targetUserId:A.id})}),[X,W,null==L?void 0:L.isFollowing,null==A?void 0:A.id,P]),Z=(0,u.useCallback)((function(e){return function(n){var i=n.subscribeNewsletterV3;B(!i),i&&(J(I),e&&e(),x(!0))}}),[X,I,J]),ee=(0,r.n)(S,{optimisticResponse:{subscribeNewsletterV3:!0},update:function(e){$(e,!0)}}),ne=(0,l.A)(ee,1)[0],ie=(0,u.useCallback)((function(e){return function(n){var i=n.unsubscribeNewsletterV3;B(!i),i&&(W.event("newsletterV3.unsubscribeClicked",{newsletterV3Id:I,source:X}),x(!1),e?e():Y({duration:y?5e3:"NEXTPAGE",toastStyle:"NEWSLETTER_UNSUBSCRIBE",extraParams:{newsletterName:_||null,newsletterType:O||null,unsubscribeFn:function(){return x(!1)},hideEmailSettingsLink:y,hideCloseButton:y}}))}}),[X,I,y,_,O]),ae=(0,r.n)(w,{optimisticResponse:{unsubscribeNewsletterV3:!0},update:function(e){$(e,!1)}}),le=(0,l.A)(ae,1)[0],te=(0,u.useCallback)((function(e){return function(n){var i=n.fetchOrLazilyCreateNewsletterV3AndMaybeSubscribe;B(!i),i&&(J(i.id),e&&e(),x(!0))}}),[X,J]),de=(0,r.n)(p,{update:function(e,n){var i,a=F({},null===(i=n.data)||void 0===i?void 0:i.fetchOrLazilyCreateNewsletterV3AndMaybeSubscribe);$(e,!0,a)}}),re=(0,l.A)(de,1)[0];return{isSubscribed:Q,hasError:U,setSubscribe:function(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2?arguments[2]:void 0;B(!1),e&&!n&&null!=i&&i.id?re({variables:{userId:null==i?void 0:i.id},onCompleted:te(l)}):e&&null!=n&&n.id?ne({variables:{newsletterV3Id:null==n?void 0:n.id,shouldRecordConsent:a},onCompleted:Z(l)}):null!=n&&n.id?le({variables:{newsletterV3Id:null==n?void 0:n.id},onCompleted:ie(l)}):B(!0)},loading:G||j}}}}]);
//# sourceMappingURL=https://stats.medium.build/lite/sourcemaps/3777.80666e51.chunk.js.map